<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة الإدارة - المدونة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <style>
    body { font-family: "Cairo", sans-serif; background:#0b1220; color:#eee; padding:20px; }
    .box { max-width:600px; margin:20px auto; background:#111827; padding:20px; border-radius:10px; }
    input, textarea { width:100%; margin:8px 0; padding:10px; border-radius:6px; border:none; }
    button { padding:10px 15px; border:none; border-radius:6px; background:#22d3ee; cursor:pointer; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>🔑 لوحة الإدارة</h1>

  <!-- شاشة تسجيل الدخول -->
  <div id="loginBox" class="box">
    <h3>تسجيل الدخول</h3>
    <input type="password" id="password" placeholder="أدخل كلمة السر">
    <button onclick="login()">دخول</button>
    <p id="msg" style="color:red"></p>
  </div>

  <!-- شاشة الإدارة -->
  <div id="adminBox" class="box hidden">
    <h3>إضافة / تعديل مقال</h3>
    <input id="title" placeholder="العنوان">
    <textarea id="content" rows="5" placeholder="المحتوى"></textarea>
    <input id="tags" placeholder="الوسوم (افصل بفواصل)">
    <input id="cover" placeholder="رابط صورة الغلاف (اختياري)">
    <p>أو اختر صورة غلاف:</p>
    <input type="file" id="coverFile" accept="image/*">
    <button onclick="addArticle()">💾 حفظ المقال</button>

    <hr>
    <h3>تحديث سطر التعريف</h3>
    <input id="tagline" placeholder="سطر التعريف الجديد">
    <button onclick="updateTagline()">تحديث</button>

    <hr>
    <h3>تغيير صورة البروفايل</h3>
    <input type="file" id="profileFile" accept="image/*">
    <button onclick="updateProfile()">رفع الصورة</button>
  </div>

  <script>
    const API = "https://pro-blog-api.onrender.com"; // عدل لرابط Render تبعك
    const ADMIN_PASS = "0598306258"; // غيّرها لكلمة سر خاصة فيك

    function login(){
      const pass = document.getElementById("password").value;
      if(pass === ADMIN_PASS){
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("adminBox").classList.remove("hidden");
      }else{
        document.getElementById("msg").innerText = "❌ كلمة السر خاطئة";
      }
    }

    async function uploadFile(file){
      const form = new FormData();
      form.append("file", file);
      const res = await fetch(API+"/upload", {method:"POST", body:form});
      if(res.ok){
        const data = await res.json();
        return data.url; // رابط الصورة
      }else{
        alert("خطأ في رفع الصورة");
        return null;
      }
    }

    async function addArticle(){
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;
      const tags = document.getElementById("tags").value.split(",");
      let cover = document.getElementById("cover").value;

      // إذا اختار صورة ملف، نرفعها
      const file = document.getElementById("coverFile").files[0];
      if(file){
        const url = await uploadFile(file);
        if(url) cover = url;
      }

      if(!title){ alert("العنوان مطلوب"); return; }

      const res = await fetch(API+"/articles", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({title, content, tags, cover})
      });
      if(res.ok){ alert("✅ تم حفظ المقال"); }
    }

    async function updateTagline(){
      const tagline = document.getElementById("tagline").value;
      const res = await fetch(API+"/settings", {
        method:"PUT",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({tagline})
      });
      if(res.ok){ alert("✅ تم تحديث سطر التعريف"); }
    }

    async function updateProfile(){
      const file = document.getElementById("profileFile").files[0];
      if(!file){ alert("اختر صورة أولاً"); return; }
      const url = await uploadFile(file);
      if(url){
        const res = await fetch(API+"/settings", {
          method:"PUT",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({profile:url})
        });
        if(res.ok){ alert("✅ تم تحديث صورة البروفايل"); }
      }
    }
  </script>
</body>
</html>